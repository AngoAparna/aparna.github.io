<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Millatte — Sugar-free Refreshments</title>
  <style>
    :root{ --bg:#f8fafc; --card:#ffffff; --accent:#16a34a; --muted:#64748b; --radius:12px; --shadow:0 8px 20px rgba(2,6,23,0.08); }
    *{box-sizing:border-box}
    body{margin:0;font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,Helvetica;background:linear-gradient(180deg,#f8fafc,#eef2ff);color:#0f172a}
    .wrap{max-width:1100px;margin:20px auto;padding:16px}
    header{display:flex;align-items:center;justify-content:space-between}
    .brand{font-weight:800;font-size:20px;letter-spacing:0.2px}
    .sub{color:var(--muted);font-size:13px}
    .grid{display:grid;grid-template-columns:1fr 360px;gap:20px;margin-top:20px}
    .card{background:var(--card);padding:14px;border-radius:var(--radius);box-shadow:var(--shadow)}
    .product-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(220px,1fr));gap:14px}
    .pimg{height:120px;border-radius:10px;background:linear-gradient(90deg,#dbeafe,#f0fdfa);display:flex;align-items:center;justify-content:center;color:#0f172a;font-weight:700}
    .btn{background:var(--accent);color:#fff;border:none;padding:8px 10px;border-radius:8px;cursor:pointer}
    .muted{color:var(--muted);font-size:13px}
    .bot-messages{height:120px;overflow:auto;background:#f8fafc;padding:8px;border-radius:8px}
    .small{font-size:13px;color:var(--muted)}
    .cart-item{display:flex;justify-content:space-between;align-items:center;margin-top:8px}
    .footer{margin-top:28px;text-align:center;color:#334155;font-size:13px}
    .rec-row{display:flex;gap:8px;margin-top:8px}
    .rec{background:#fff;padding:8px;border-radius:8px;box-shadow:0 4px 12px rgba(2,6,23,0.04)}
    @media(max-width:880px){ .grid{grid-template-columns:1fr} .brand{font-size:18px} .grid aside{order:2} }
    a.link{color:var(--accent);text-decoration:none}
    .logo{display:flex;gap:8px;align-items:center}
    .logo .dot{width:36px;height:36px;border-radius:10px;background:linear-gradient(135deg,#a78bfa,#60a5fa);display:flex;align-items:center;justify-content:center;color:white;font-weight:800}
    .download-btn{display:inline-block;margin-top:8px;padding:6px 10px;background:#0ea5e9;color:#fff;border-radius:8px;text-decoration:none}
  </style>
</head>
<body>
  <div class="wrap">
    <header>
      <div class="logo">
        <div class="dot">M</div>
        <div>
          <div class="brand">Millatte</div>
          <div class="sub">Sugar-free • Refreshing • Matcha bottled</div>
        </div>
      </div>
      <div>
        <div id="cart-count">Cart: 0</div>
      </div>
    </header>

    <div class="grid">
      <main>
        <div class="card">
          <h2 style="margin:0">About Millatte</h2>
          <p class="muted" style="margin-top:8px">Health-first beverages — sugar-free, affordable, refreshing and great taste. Try our bottled Matcha — crafted for Gen-Z energy and balance.</p>
        </div>

        <div style="margin-top:14px" class="card">
          <h3 style="margin:0">Products</h3>
          <div id="products" class="product-grid" style="margin-top:12px"></div>
        </div>

        <div style="margin-top:14px" class="card">
          <h3 style="margin:0">Recommended for you</h3>
          <div id="recs" class="rec-row"></div>
        </div>
      </main>

      <aside>
        <div class="card">
          <h4 style="margin:0">Help Bot</h4>
          <div class="bot-messages" id="botMessages" style="margin-top:8px"></div>
          <div style="display:flex;gap:8px;margin-top:8px">
            <input id="botInput" placeholder="Ask a question..." style="flex:1;padding:8px;border-radius:8px;border:1px solid #e6edf3" />
            <button class="btn" id="botSend">Ask</button>
          </div>
          <div class="small" style="margin-top:6px">Try: “is this sugar free” / “do you deliver”</div>
        </div>

        <div class="card" style="margin-top:12px">
          <h4 style="margin:0">Cart</h4>
          <div id="cartList" style="margin-top:8px" class="small">Cart is empty</div>

          <hr style="margin:12px 0" />
          <form id="checkoutForm">
            <input name="name" placeholder="Name" style="width:100%;padding:8px;margin-bottom:8px;border-radius:8px;border:1px solid #e6edf3" />
            <input name="phone" placeholder="Phone (e.g. 919XXXXXXXXX)" style="width:100%;padding:8px;margin-bottom:8px;border-radius:8px;border:1px solid #e6edf3" />
            <textarea name="address" placeholder="Address" style="width:100%;padding:8px;margin-bottom:8px;border-radius:8px;border:1px solid #e6edf3"></textarea>
            <button type="submit" class="btn" style="width:100%">Place order (WhatsApp)</button>
          </form>
        </div>

        <div class="card" style="margin-top:12px">
          <div class="small">Owner tools</div>
          <a id="downloadOrders" class="download-btn" href="#" download="millatte-orders.csv">Download orders CSV</a>
          <div style="margin-top:8px" class="small">Tip: open the CSV in Excel to see orders.</div>
        </div>
      </aside>
    </div>

    <div class="footer">© Millatte — Healthy beverages • Sugar-free • Matcha bottled</div>
  </div>

  <script>
  /**************************************
   * Millatte HTML — ready to run
   * WhatsApp number prefilled and Google Form wired (from your prefill link)
   *
   * Google Form mapping used:
   * orderId -> entry.1054609344
   * name    -> entry.1099864676
   * phone   -> entry.2119019468
   * address -> entry.441643550
   * total   -> entry.1445951231
   * cart    -> entry.1346159692
   * createdAt -> entry.203310628
   **************************************/

  const BUSINESS_WHATSAPP_NUMBER = "917093902898"; // your number (country code + number, no +)
  const GOOGLE_FORM_URL = "https://docs.google.com/forms/d/e/1FAIpQLSeFiBBhdIaI6b2mbdn_YOBrYOTDpJp3qhhw4F_2xbwT4vYTMQ/formResponse";
  const GOOGLE_FORM_FIELDS = {
    orderId: "entry.1054609344",
    name:    "entry.1099864676",
    phone:   "entry.2119019468",
    address: "entry.441643550",
    total:   "entry.1445951231",
    cart:    "entry.1346159692",
    createdAt: "entry.203310628"
  };

  // Products (edit if you want)
  const PRODUCTS = [
    { id: "p_matcha_01", name: "Iced Matcha Bottle (Sugar-free)", tagline: "Silky ceremonial matcha — sugar-free and refreshing.", price: 140, tags: ["matcha","sugar-free","refreshing"] },
    { id: "p_citrus_01", name: "Citrus Spark", tagline: "Zesty, vitamin-rich, low-cal.", price: 90, tags: ["citrus","vitamin","low-cal"] },
    { id: "p_herbal_01", name: "Herbal Chill", tagline: "Calming herbal infusion — natural flavors.", price: 95, tags: ["herbal","calm","no-sugar"] }
  ];

  const LS_ORDERS_KEY = "millatte_orders_v1";
  const LS_CART_KEY = "millatte_cart_v1";

  function $(id){ return document.getElementById(id) }
  function formatCurrency(n){ return "₹" + n.toFixed(0) }

  function renderProducts(){
    const container = $("products");
    container.innerHTML = "";
    PRODUCTS.forEach(p=>{
      const el = document.createElement("div");
      el.className = "card";
      el.innerHTML = `
        <div class="pimg">${p.name.split(" ")[0]}</div>
        <div style="font-weight:700;margin-top:8px">${p.name}</div>
        <div class="muted" style="margin-top:6px">${p.tagline}</div>
        <div style="display:flex;justify-content:space-between;align-items:center;margin-top:10px">
          <div style="font-weight:700">${formatCurrency(p.price)}</div>
          <button class="btn" data-id="${p.id}">Add</button>
        </div>
      `;
      container.appendChild(el);
    });
    container.querySelectorAll("button.btn").forEach(btn=>{
      btn.addEventListener("click", ()=> {
        const id = btn.getAttribute("data-id");
        addToCart(PRODUCTS.find(x=>x.id===id));
      });
    });
  }

  function loadCart(){ try{ return JSON.parse(localStorage.getItem(LS_CART_KEY) || "[]") }catch(e){ return [] } }
  function saveCart(cart){ localStorage.setItem(LS_CART_KEY, JSON.stringify(cart)); renderCart(); renderRecs(); updateDownloadLink() }
  function addToCart(product){
    const cart = loadCart();
    const idx = cart.findIndex(i=>i.id===product.id);
    if (idx >= 0) { cart[idx].qty += 1 } else { cart.push({...product, qty:1}) }
    saveCart(cart);
    recordActivity({ event: "add_to_cart", productId: product.id });
    showToast("Added to cart");
  }
  function removeFromCart(id){
    let cart = loadCart();
    cart = cart.filter(i=>i.id!==id);
    saveCart(cart);
  }
  function renderCart(){
    const cart = loadCart();
    $("cart-count").innerText = "Cart: " + cart.reduce((s,i)=>s+i.qty,0);
    const list = $("cartList");
    if (!cart.length) { list.innerHTML = "<div class='muted'>Cart is empty</div>"; return }
    list.innerHTML = "";
    cart.forEach(item=>{
      const d = document.createElement("div");
      d.className = "cart-item";
      d.innerHTML = `
        <div>
          <div style="font-weight:700">${item.name}</div>
          <div class="muted">${item.qty} × ${formatCurrency(item.price)}</div>
        </div>
        <div>
          <button data-id="${item.id}" style="background:transparent;border:none;color:#ef4444;cursor:pointer">Remove</button>
        </div>
      `;
      list.appendChild(d);
    });
    list.querySelectorAll("button[data-id]").forEach(b=>{
      b.addEventListener("click", ()=> removeFromCart(b.getAttribute("data-id")));
    });
  }

  function renderRecs(){
    const cart = loadCart();
    const recContainer = $("recs");
    recContainer.innerHTML = "";
    let recs = [];
    if (cart.length){
      const tags = new Set(cart.flatMap(i=>i.tags || []));
      recs = PRODUCTS.filter(p => p.tags && p.tags.some(t => tags.has(t)) && !cart.some(c=>c.id===p.id));
    }
    if (!recs.length) recs = PRODUCTS.slice(0,3);
    recs.slice(0,3).forEach(r=>{
      const el = document.createElement("div");
      el.className = "rec";
      el.innerHTML = `<div style="font-weight:700">${r.name}</div><div class="muted">₹${r.price}</div>`;
      recContainer.appendChild(el);
    });
  }

  const FAQ = [
    { q: "is this sugar free", a: "Yes — our products are sugar-free or low-cal where noted." },
    { q: "do you deliver", a: "We deliver across India via courier partners. You will be redirected to WhatsApp to confirm the order." },
    { q: "how long matcha lasts", a: "Unopened bottles: 6 months. Once opened: refrigerate and consume within 3 days." }
  ];
  function botAsk(text){
    const box = $("botMessages");
    const userDiv = document.createElement("div");
    userDiv.style.textAlign = "right";
    userDiv.style.marginBottom = "6px";
    userDiv.innerHTML = `<small><strong>You:</strong> ${escapeHtml(text)}</small>`;
    box.appendChild(userDiv);
    box.scrollTop = box.scrollHeight;
    const lower = (text || "").toLowerCase();
    const found = FAQ.find(f => lower.includes(f.q.split(' ')[0]) || lower.includes(f.q));
    const reply = found ? found.a : "Sorry — please contact us on WhatsApp for help.";
    setTimeout(()=> {
      const botDiv = document.createElement("div");
      botDiv.style.textAlign = "left";
      botDiv.style.marginBottom = "6px";
      botDiv.innerHTML = `<small><strong>Bot:</strong> ${escapeHtml(reply)}</small>`;
      box.appendChild(botDiv);
      box.scrollTop = box.scrollHeight;
    }, 250);
  }

  function checkoutHandler(ev){
    ev.preventDefault();
    const form = ev.target;
    const name = form.name.value.trim();
    const phone = form.phone.value.trim();
    const address = form.address.value.trim();
    const cart = loadCart();
    if (!name || !phone || cart.length===0) return alert("Please enter name, phone and add at least 1 item.");
    const total = cart.reduce((s,i)=>s + (i.price||0) * (i.qty||1), 0);
    const orderId = "ORD-" + Date.now();
    const createdAt = new Date().toISOString();
    const order = { orderId, name, phone, address, cart, total, createdAt };

    // save locally
    const orders = loadOrders();
    orders.push(order);
    localStorage.setItem(LS_ORDERS_KEY, JSON.stringify(orders));

    // try post to Google Form
    trySubmitToGoogleForm(order);

    // build whatsapp message and open
    const itemsText = cart.map(i => `${i.name} x${i.qty}`).join(", ");
    const msg = `Hi Millatte team! I placed an order (ID: ${orderId}).\\nName: ${name}\\nPhone: ${phone}\\nAddress: ${address}\\nTotal: ₹${total}\\nItems: ${itemsText}`;
    const encoded = encodeURIComponent(msg);
    const wa = `https://wa.me/${BUSINESS_WHATSAPP_NUMBER}?text=${encoded}`;

    localStorage.removeItem(LS_CART_KEY);
    renderCart(); renderRecs(); updateDownloadLink();
    window.open(wa, "_blank");
    showToast("Order created — opening WhatsApp for confirmation");
  }

  function trySubmitToGoogleForm(order){
    if (!GOOGLE_FORM_URL) return;
    try {
      const params = new URLSearchParams();
      for (const key of ["orderId","name","phone","address","total","cart","createdAt"]) {
        const entryKey = GOOGLE_FORM_FIELDS[key];
        if (!entryKey) continue;
        let value = order[key];
        if (key === "cart") value = JSON.stringify(order.cart.map(i=>({name:i.name, qty:i.qty, price:i.price})));
        params.append(entryKey, value);
      }
      fetch(GOOGLE_FORM_URL, { method: "POST", body: params, mode: "no-cors" })
        .then(()=> console.log("Posted order to Google Form (attempt)"))
        .catch(err=> console.warn("Google Form post error:", err));
    } catch (e) {
      console.warn("trySubmitToGoogleForm failed", e);
    }
  }

  function loadOrders(){ try{ return JSON.parse(localStorage.getItem(LS_ORDERS_KEY) || "[]") } catch(e) { return [] } }
  function ordersToCSV(orders){
    if (!orders.length) return "";
    const rows = [];
    const header = ["orderId","name","phone","address","total","cart","createdAt"];
    rows.push(header.join(","));
    orders.forEach(o=>{
      const cartStr = '"' + o.cart.map(i=>`${i.name} x${i.qty}`).join("; ") + '"';
      rows.push([o.orderId, escapeCsv(o.name), escapeCsv(o.phone), escapeCsv(o.address), o.total, cartStr, o.createdAt].join(","));
    });
    return rows.join("\\n");
  }
  function updateDownloadLink(){
    const orders = loadOrders();
    const csv = ordersToCSV(orders);
    const blob = new Blob([csv], { type: "text/csv;charset=utf-8;" });
    const url = csv ? URL.createObjectURL(blob) : "";
    const a = $("downloadOrders");
    if (url) { a.href = url; a.style.pointerEvents = "auto"; } else { a.href = "#"; a.style.pointerEvents = "none"; }
  }

  function recordActivity(obj){
    try {
      const key = "millatte_activity_v1";
      const list = JSON.parse(localStorage.getItem(key) || "[]");
      list.push({ ...obj, ts: new Date().toISOString() });
      localStorage.setItem(key, JSON.stringify(list));
    } catch(e){}
  }

  function escapeHtml(s){ return String(s).replace(/[&<>"']/g, (m)=> ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',\"'\":'&#39;'}[m]) ) }
  function escapeCsv(s){ if (s==null) return ""; return '"' + String(s).replace(/"/g,'""') + '"' }
  function showToast(msg){ console.log(msg); }

  document.addEventListener("DOMContentLoaded", ()=>{
    renderProducts();
    renderCart();
    renderRecs();
    updateDownloadLink();

    $("botSend").addEventListener("click", ()=> {
      const v = $("botInput").value.trim(); if (!v) return;
      botAsk(v);
      $("botInput").value = "";
    });
    $("botInput").addEventListener("keydown", (e)=> { if (e.key === "Enter") { e.preventDefault(); $("botSend").click(); }});

    $("checkoutForm").addEventListener("submit", checkoutHandler);

    window.addEventListener("storage", ()=> updateDownloadLink());
    setInterval(updateDownloadLink, 2000);

    recordActivity({ event: "visit_home" });
  });
  </script>
</body>
</html>
